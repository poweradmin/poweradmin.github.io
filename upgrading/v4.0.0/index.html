<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.poweradmin.org/upgrading/v4.0.0/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>v4.0.0 - Poweradmin Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "v4.0.0";
        var mkdocs_page_input_path = "upgrading/v4.0.0.md";
        var mkdocs_page_url = "/upgrading/v4.0.0/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/php.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Poweradmin Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/features/">Features</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Quick Evaluation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../getting-started/docker-demo/">Docker Demo</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/requirements/">System Requirements</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Operating Systems</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../installation/debian/">Debian</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../installation/ubuntu/">Ubuntu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../installation/centos/">CentOS/RHEL</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Database Setup</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../database/mysql-configuration/">MySQL/MariaDB</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../database/postgresql-configuration/">PostgreSQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../database/sqlite/">SQLite</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/manual/">Manual Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/composer/">Composer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/remote-setup-guide/">Remote Setup</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Configuration</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/basic/">Basic Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/dns-settings/">DNS Settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/database/">Database Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/powerdns-api/">PowerDNS API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/dnssec/">DNSSEC</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/logging/">Logging Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/ldap/">LDAP Integration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/mail/">Mail Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/record-types/">Record Type Customization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >UI Customization</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ui/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ui/themes/">Themes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ui/layout/">Layout</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ui/custom-css/">Custom CSS</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/password-policies/">Password Policies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/security-policies/">Security Policies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/api/">API Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/whois/">WHOIS Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/rdap/">RDAP Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configuration/user-agreements/">User Agreements</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >User Management</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../user-guide/users-roles/">Users and Roles</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../user-guide/permissions/">Permissions</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >DNS Management</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../user-guide/dns-templates/">DNS Templates</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../user-guide/reverse-dns/">Reverse DNS (PTR)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Dynamic DNS</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../user-guide/ddns/overview/">Overview</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user-guide/ddns/configuration/">Configuration</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user-guide/ddns/client-setup/">Client Setup</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user-guide/ddns/using-curl/">Using cURL</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced Topics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Logging</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced/logging-config/">Log Configuration</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Maintenance</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../maintenance/">Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Upgrading</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">Overview</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >v4.x Series</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">v4.0.0</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-changes">Key Changes</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#upgrade-instructions">Upgrade Instructions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration-migration">Configuration Migration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#automatic-migration-recommended">Automatic Migration (Recommended)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#configuration-changes-overview">Configuration Changes Overview</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#manual-migration-steps">Manual Migration Steps</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#database-schema-updates">Database Schema Updates</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#new-tables-added-in-v400">New Tables Added in v4.0.0</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#database-migration-files">Database Migration Files</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#migration-prerequisites-and-upgrading-from-older-versions">Migration Prerequisites and Upgrading from Older Versions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#verify-database-migration-completeness">Verify Database Migration Completeness</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#new-feature-dns-record-type-customization">New Feature: DNS Record Type Customization</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#new-features-in-v400">New Features in v4.0.0</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#enhanced-security-features">Enhanced Security Features</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#api-management">API Management</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#user-experience-improvements">User Experience Improvements</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#lookup-and-integration-features">Lookup and Integration Features</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#email-system-enhancements">Email System Enhancements</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#zone-management-features">Zone Management Features</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#user-management-features">User Management Features</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#administrative-features">Administrative Features</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#configuration-examples">Configuration Examples</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#post-upgrade-configuration">Post-Upgrade Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#security-features-configuration">Security Features Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#user-management-features_1">User Management Features</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#communication-features">Communication Features</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#external-services-integration">External Services Integration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#api-and-development-features">API and Development Features</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >v3.x Series</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >v3.9.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.9.3/">v3.9.3</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v3.9.2/">v3.9.2</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v3.9.1/">v3.9.1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v3.9.0/">v3.9.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.8.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.8.1/">v3.8.1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v3.8.0/">v3.8.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.7.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.7.0/">v3.7.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.6.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.6.1/">v3.6.1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v3.6.0/">v3.6.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.5.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.5.1/">v3.5.1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v3.5.0/">v3.5.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.4.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.4.2/">v3.4.2</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v3.4.1/">v3.4.1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v3.4.0/">v3.4.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.3.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.3.0/">v3.3.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.2.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.2.0/">v3.2.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.1.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.1.0/">v3.1.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v3.0.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v3.0.0/">v3.0.0</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >v2.x Series</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >v2.2.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v2.2.2/">v2.2.2</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.2.1/">v2.2.1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.2.0/">v2.2.0</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >v2.1.x</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.9/">v2.1.9</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.8/">v2.1.8</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.7/">v2.1.7</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.6/">v2.1.6</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.5/">v2.1.5</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.4/">v2.1.4</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.3/">v2.1.3</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.2/">v2.1.2</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.1/">v2.1.1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../v2.1.0/">v2.1.0</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Troubleshooting</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/debugging/">Debugging</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../contributing/development/">Development Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../contributing/coding-standards/">Coding Standards</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../contributing/testing/">Testing</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Poweradmin Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Upgrading</li>
          <li class="breadcrumb-item">v4.x Series</li>
      <li class="breadcrumb-item active">v4.0.0</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/poweradmin/poweradmin-docs/edit/main/docs/upgrading/v4.0.0.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
  <div class="announcement">
    Note: This documentation is still in progress, not reviewed properly, and might contain some errors or outdated images. It's intended for the upcoming 4.0.0 release, so configuration settings might be different from previous versions.
  </div>
  
                <h1 id="upgrading-to-version-400">Upgrading to Version 4.0.0</h1>
<h2 id="overview">Overview</h2>
<p>Version 4.0.0 represents a major update to Poweradmin with significant architectural improvements, enhanced security features, and a new configuration system. This guide will help you migrate from older versions.</p>
<h2 id="key-changes">Key Changes</h2>
<ul>
<li>Configuration file format and location have changed</li>
<li>Database schema updates including 8 new tables for enhanced functionality</li>
<li>New theming system with light/dark mode support</li>
<li>Enhanced security with multi-factor authentication (MFA)</li>
<li>Advanced account lockout and password reset features</li>
<li>API key management system</li>
<li>User preferences and agreements system</li>
<li>Google reCAPTCHA integration</li>
<li>WHOIS and RDAP lookup functionality</li>
<li>Enhanced email system with multiple transport options</li>
<li>Improved object-oriented architecture with proper separation of concerns</li>
</ul>
<h2 id="upgrade-instructions">Upgrade Instructions</h2>
<ol>
<li>Download latest tarball from <a href="https://github.com/poweradmin/poweradmin/releases/tag/v4.0.0">GitHub</a></li>
<li><strong>Backup your files and database before proceeding</strong> - this is especially important for a major version upgrade</li>
<li>Replace all files with content from the downloaded archive</li>
<li>Run the database migration (see Database Schema Updates section below)</li>
<li>Migrate your configuration (see Configuration Changes section below)</li>
</ol>
<h2 id="configuration-migration">Configuration Migration</h2>
<h3 id="automatic-migration-recommended">Automatic Migration (Recommended)</h3>
<p>If you're upgrading from an older version of Poweradmin (pre-4.0.0), use the automatic migration script:</p>
<pre><code class="language-bash">php config/migrate-config.php
</code></pre>
<p>This will convert your old <code>inc/config.inc.php</code> settings to the new <code>config/settings.php</code> format.</p>
<h3 id="configuration-changes-overview">Configuration Changes Overview</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Old (pre-4.0.0)</th>
<th>New (4.0.0+)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Location</strong></td>
<td><code>inc/config.inc.php</code></td>
<td><code>config/settings.php</code></td>
</tr>
<tr>
<td><strong>Format</strong></td>
<td>Direct variable assignments</td>
<td>Structured array format</td>
</tr>
</tbody>
</table>
<h4 id="configuration-format-examples">Configuration Format Examples</h4>
<p><strong>Old Format (pre-4.0.0):</strong></p>
<pre><code class="language-php">$db_host = 'localhost';
$db_user = 'poweradmin';
$db_pass = 'password';
$db_name = 'powerdns';
$db_type = 'mysql';
</code></pre>
<p><strong>New Format (4.0.0+):</strong></p>
<pre><code class="language-php">return [
    'database' =&gt; [
        'host' =&gt; 'localhost',
        'user' =&gt; 'poweradmin',
        'password' =&gt; 'password',
        'name' =&gt; 'powerdns',
        'type' =&gt; 'mysql',
    ],
];
</code></pre>
<h3 id="manual-migration-steps">Manual Migration Steps</h3>
<p>If the automatic migration script doesn't work for your setup:</p>
<ol>
<li>Create a new <code>config/settings.php</code> file</li>
<li>Refer to <code>config/settings.defaults.php</code> for available options</li>
<li>Map your old settings to the new format using the examples above</li>
<li>Test the configuration thoroughly</li>
</ol>
<h2 id="database-schema-updates">Database Schema Updates</h2>
<p>Version 4.0.0 introduces significant database schema changes including multiple new tables for enhanced security, API management, user preferences, and multi-factor authentication.</p>
<h3 id="new-tables-added-in-v400">New Tables Added in v4.0.0</h3>
<ul>
<li><code>login_attempts</code> - Login attempt tracking for security</li>
<li><code>migrations</code> - Database migration tracking</li>
<li><code>api_keys</code> - API access management  </li>
<li><code>user_mfa</code> - Multi-factor authentication support</li>
<li><code>user_preferences</code> - User preferences and settings</li>
<li><code>zone_template_sync</code> - Zone template synchronization</li>
<li><code>password_reset_tokens</code> - Password reset functionality</li>
<li><code>user_agreements</code> - User agreement tracking</li>
</ul>
<h3 id="database-migration-files">Database Migration Files</h3>
<p><strong>Important</strong>: Instead of running individual SQL statements, use the dedicated migration files from the Poweradmin repository:</p>
<p><strong>MySQL:</strong></p>
<pre><code class="language-bash">mysql -u [username] -p [database_name] &lt; sql/poweradmin-mysql-update-to-4.0.0.sql
</code></pre>
<p>Download: <a href="https://github.com/poweradmin/poweradmin/blob/master/sql/poweradmin-mysql-update-to-4.0.0.sql">poweradmin-mysql-update-to-4.0.0.sql</a></p>
<p><strong>PostgreSQL:</strong></p>
<pre><code class="language-bash">psql -U [username] -d [database_name] -f sql/poweradmin-pgsql-update-to-4.0.0.sql
</code></pre>
<p>Download: <a href="https://github.com/poweradmin/poweradmin/blob/master/sql/poweradmin-pgsql-update-to-4.0.0.sql">poweradmin-pgsql-update-to-4.0.0.sql</a></p>
<p><strong>SQLite:</strong></p>
<pre><code class="language-bash">sqlite3 [database_file] &lt; sql/poweradmin-sqlite-update-to-4.0.0.sql
</code></pre>
<p>Download: <a href="https://github.com/poweradmin/poweradmin/blob/master/sql/poweradmin-sqlite-update-to-4.0.0.sql">poweradmin-sqlite-update-to-4.0.0.sql</a></p>
<h3 id="migration-prerequisites-and-upgrading-from-older-versions">Migration Prerequisites and Upgrading from Older Versions</h3>
<p><strong>Important</strong>: If you're upgrading from a version earlier than v3.9.0, you must upgrade incrementally:</p>
<ol>
<li><strong>From v2.x.x</strong>: First upgrade to v3.0.0 (see <a href="../v3.0.0/">v3.0.0 upgrade guide</a>)</li>
<li><strong>From v3.0.x to v3.1.x</strong>: Upgrade to v3.2.0 (see <a href="../v3.2.0/">v3.2.0 upgrade guide</a>)  </li>
<li><strong>From v3.2.x to v3.8.x</strong>: Upgrade to v3.9.0 (see <a href="../v3.9.0/">v3.9.0 upgrade guide</a>)</li>
<li><strong>From v3.9.x</strong>: Follow this guide to upgrade to v4.0.0</li>
</ol>
<p>This incremental approach ensures all database migrations are applied correctly and configurations are properly migrated.</p>
<h3 id="verify-database-migration-completeness">Verify Database Migration Completeness</h3>
<p>After running the migration, verify your database contains all 8 new tables:</p>
<p><strong>Verification Query (MySQL):</strong></p>
<pre><code class="language-sql">SELECT TABLE_NAME FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database_name' 
AND TABLE_NAME IN ('migrations', 'login_attempts', 'api_keys', 'user_mfa', 'user_preferences', 'zone_template_sync', 'password_reset_tokens', 'user_agreements');
</code></pre>
<p><strong>Expected Result:</strong> You should see all 8 tables listed in the "New Tables Added in v4.0.0" section above.</p>
<p>If any tables are missing, the migration may have failed. Check the migration logs for errors.</p>
<h2 id="new-feature-dns-record-type-customization">New Feature: DNS Record Type Customization</h2>
<p>Version 4.0.0 introduces the ability to customize which DNS record types are available in the interface. This feature helps simplify the user interface by showing only the record types that are relevant to your specific DNS needs.</p>
<p>To configure this feature, add the following to your <code>config/settings.php</code> file:</p>
<pre><code class="language-php">'dns' =&gt; [
    // Other DNS settings...

    // Record Type Settings
    'domain_record_types' =&gt; ['A', 'AAAA', 'CNAME', 'MX', 'NS', 'SOA', 'TXT'], // For forward zones
    'reverse_record_types' =&gt; ['PTR', 'NS', 'SOA'],                            // For reverse zones
]
</code></pre>
<p>For full documentation on this feature, see <a href="../../configuration/record-types/">Record Type Customization</a>.</p>
<h2 id="new-features-in-v400">New Features in v4.0.0</h2>
<h3 id="enhanced-security-features">Enhanced Security Features</h3>
<ul>
<li>
<p><strong>Multi-Factor Authentication (MFA)</strong></p>
<ul>
<li>Support for authenticator apps (TOTP)</li>
<li>Email-based verification</li>
<li>Recovery codes for account recovery</li>
<li>Configurable recovery code generation</li>
</ul>
</li>
<li>
<p><strong>Advanced Account Lockout</strong></p>
<ul>
<li>Login attempt tracking with database support</li>
<li>Configurable lockout attempts and duration</li>
<li>IP address-based tracking and lockouts</li>
<li>Whitelist and blacklist support (supports IPs, CIDRs, wildcards)</li>
</ul>
</li>
<li>
<p><strong>Password Reset System</strong></p>
<ul>
<li>Secure password reset via email</li>
<li>Configurable token lifetime and rate limiting</li>
<li>Protection against brute force attacks</li>
</ul>
</li>
<li>
<p><strong>Google reCAPTCHA Integration</strong></p>
<ul>
<li>Support for reCAPTCHA v2 and v3</li>
<li>Configurable score thresholds for v3</li>
<li>Login form protection</li>
</ul>
</li>
<li>
<p><strong>Enhanced Password Policies</strong></p>
<ul>
<li>Configurable minimum length requirements</li>
<li>Character type requirements (uppercase, lowercase, numbers, special)</li>
<li>Custom special character sets</li>
</ul>
</li>
</ul>
<h3 id="api-management">API Management</h3>
<ul>
<li><strong>API Key System</strong><ul>
<li>Generate and manage API keys for external integrations</li>
<li>Key-based authentication for API endpoints</li>
<li>Request logging and monitoring</li>
<li>API documentation endpoints</li>
</ul>
</li>
</ul>
<h3 id="user-experience-improvements">User Experience Improvements</h3>
<ul>
<li>
<p><strong>Theming System</strong></p>
<ul>
<li>Light and dark mode support</li>
<li>Customizable theme base paths</li>
<li>Theme selection per user preference</li>
</ul>
</li>
<li>
<p><strong>User Preferences</strong></p>
<ul>
<li>Personalized user settings storage</li>
<li>Individual user customization options</li>
</ul>
</li>
<li>
<p><strong>Enhanced Interface Options</strong></p>
<ul>
<li>Display full names instead of usernames in zone lists</li>
<li>Improved reverse zone sorting (natural or hierarchical)</li>
<li>PowerDNS server status integration</li>
<li>Database consistency checks page</li>
<li>Email template previews</li>
<li>Display hostname only in zone edit forms (strips zone suffix)</li>
<li>Prevent duplicate PTR records in batch operations</li>
<li>Configurable display of generated passwords</li>
<li>PHP error display control for development/production</li>
</ul>
</li>
<li>
<p><strong>Advanced Workflow Configuration</strong></p>
<ul>
<li><strong>Edit Conflict Resolution</strong>: Three strategies for handling concurrent edits:<ul>
<li><code>last_writer_wins</code> (default): Latest changes override previous ones</li>
<li><code>only_latest_version</code>: Prevent editing of outdated versions</li>
<li><code>3_way_merge</code>: Attempt to merge conflicting changes</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="lookup-and-integration-features">Lookup and Integration Features</h3>
<ul>
<li>
<p><strong>WHOIS Lookup</strong></p>
<ul>
<li>Built-in WHOIS query functionality</li>
<li>Configurable WHOIS servers</li>
<li>Socket timeout controls</li>
<li>Admin-only access controls</li>
</ul>
</li>
<li>
<p><strong>RDAP Lookup</strong></p>
<ul>
<li>Registration Data Access Protocol support</li>
<li>HTTP-based domain information queries</li>
<li>Configurable RDAP servers</li>
<li>Request timeout controls</li>
</ul>
</li>
</ul>
<h3 id="email-system-enhancements">Email System Enhancements</h3>
<ul>
<li><strong>Multiple Transport Options</strong><ul>
<li>SMTP with authentication and encryption</li>
<li>Sendmail binary support</li>
<li>PHP mail() function</li>
<li>Configurable return paths</li>
</ul>
</li>
</ul>
<h3 id="zone-management-features">Zone Management Features</h3>
<ul>
<li>
<p><strong>Zone Template Enhancements</strong></p>
<ul>
<li><strong>Template Ownership Tracking</strong>: New <code>created_by</code> field tracks who created each template</li>
<li><strong>Enhanced Permissions</strong>: New granular permissions system with two new permissions:<ul>
<li><code>zone_templ_add</code>: "User is allowed to add new zone templates"</li>
<li><code>zone_templ_edit</code>: "User is allowed to edit existing zone templates"</li>
</ul>
</li>
<li><strong>Template-Zone Synchronization</strong>: New <code>zone_template_sync</code> table tracks sync status between templates and zones</li>
<li><strong>Change Detection</strong>: System detects when templates need to be re-synchronized with zones</li>
<li><strong>Template Unlinking</strong>: Ability to unlink zones from templates when needed</li>
<li><strong>Batch Operations</strong>: Support for bulk template operations and zone updates</li>
</ul>
</li>
<li>
<p><strong>Bulk Operations Suite</strong></p>
<ul>
<li><strong>Bulk Record Addition</strong>: Add multiple DNS records at once to existing zones</li>
<li><strong>Bulk Zone Registration</strong>: Register multiple zones simultaneously with templates</li>
<li><strong>Batch PTR Record Creation</strong>: Automated batch creation of reverse DNS records</li>
<li><strong>Bulk Zone Management</strong>: Streamlined operations for managing large numbers of zones</li>
</ul>
</li>
</ul>
<h3 id="user-management-features">User Management Features</h3>
<ul>
<li><strong>User Agreements System</strong><ul>
<li>Version-controlled user agreements with database tracking</li>
<li>IP address and user agent logging for compliance</li>
<li>Automatic re-acceptance requirement on version changes</li>
<li>Custom agreement content per theme</li>
<li>Admin-controlled versioning and enforcement</li>
<li>Graceful handling when disabled (users bypass agreement screen)</li>
</ul>
</li>
</ul>
<h3 id="administrative-features">Administrative Features</h3>
<ul>
<li>
<p><strong>Advanced Administrative Tools</strong></p>
<ul>
<li><strong>Database Consistency Checker</strong>: Automated database integrity checks and repair tools</li>
<li><strong>Migrations Management Interface</strong>: Web-based database migration management</li>
<li><strong>Email Template Preview System</strong>: Administrators can preview email templates before sending</li>
<li><strong>PowerDNS Status Integration</strong>: Real-time server monitoring and status display</li>
</ul>
</li>
<li>
<p><strong>Enhanced Logging</strong></p>
<ul>
<li>Improved logging levels and types</li>
<li>Database activity logging</li>
<li>API request logging</li>
<li>Syslog integration</li>
</ul>
</li>
<li>
<p><strong>Improved PowerDNS Integration</strong></p>
<ul>
<li>Enhanced API connectivity</li>
<li>Server status monitoring</li>
<li>Better error handling</li>
</ul>
</li>
</ul>
<h3 id="configuration-examples">Configuration Examples</h3>
<p><strong>Enable MFA:</strong></p>
<pre><code class="language-php">'security' =&gt; [
    'mfa' =&gt; [
        'enabled' =&gt; true,
        'app_enabled' =&gt; true,
        'email_enabled' =&gt; true,
        'recovery_codes' =&gt; 8,
    ],
],
</code></pre>
<p><strong>Configure Account Lockout:</strong></p>
<pre><code class="language-php">'security' =&gt; [
    'account_lockout' =&gt; [
        'enable_lockout' =&gt; true,
        'lockout_attempts' =&gt; 5,
        'lockout_duration' =&gt; 15,
        'whitelist_ip_addresses' =&gt; ['127.0.0.1', '192.168.1.0/24'],
    ],
],
</code></pre>
<p><strong>Enable API with reCAPTCHA:</strong></p>
<pre><code class="language-php">'api' =&gt; [
    'enabled' =&gt; true,
    'docs_enabled' =&gt; true,
],
'security' =&gt; [
    'recaptcha' =&gt; [
        'enabled' =&gt; true,
        'site_key' =&gt; 'your_site_key',
        'secret_key' =&gt; 'your_secret_key',
        'version' =&gt; 'v3',
    ],
],
</code></pre>
<p><strong>Configure User Agreement System:</strong></p>
<pre><code class="language-php">'user_agreement' =&gt; [
    'enabled' =&gt; true,                           // Enable user agreement system
    'current_version' =&gt; '2.0',                  // Current agreement version
    'require_on_version_change' =&gt; true,         // Force re-acceptance on version updates
],
</code></pre>
<p><strong>Enable Administrative Tools:</strong></p>
<pre><code class="language-php">'interface' =&gt; [
    'enable_consistency_checks' =&gt; true,        // Enable database consistency checker
    'show_pdns_status' =&gt; true,                 // Show PowerDNS server status page
],
'misc' =&gt; [
    'email_previews_enabled' =&gt; true,           // Enable email template previews
    'edit_conflict_resolution' =&gt; 'only_latest_version', // Prevent concurrent edit conflicts
],
</code></pre>
<p><strong>Configure Enhanced Interface Options:</strong></p>
<pre><code class="language-php">'interface' =&gt; [
    'display_hostname_only' =&gt; true,            // Strip zone suffix in edit forms
    'display_fullname_in_zone_list' =&gt; true,    // Show full names instead of usernames
    'reverse_zone_sort' =&gt; 'hierarchical',      // Use hierarchical reverse zone sorting
],
'dns' =&gt; [
    'prevent_duplicate_ptr' =&gt; true,            // Prevent duplicate PTR records in batch ops
],
'misc' =&gt; [
    'show_generated_passwords' =&gt; false,        // Hide generated passwords for security
    'display_errors' =&gt; false,                  // Disable PHP error display for production
],
</code></pre>
<h2 id="notes">Notes</h2>
<ul>
<li>Legacy configuration format (<code>inc/config.inc.php</code>) is still supported but will be removed in a future version</li>
<li>You can have both configuration files during the transition period</li>
<li>The new configuration system offers more flexibility and better organization</li>
<li>Review security settings after upgrade to take advantage of new account lockout features</li>
<li>This is a significant update that lays groundwork for future improvements</li>
<li>Consider testing in a staging environment before applying to production</li>
</ul>
<h2 id="post-upgrade-configuration">Post-Upgrade Configuration</h2>
<p>Many of the new v4.0.0 features require additional configuration to enable. Here are the key areas to configure after upgrading:</p>
<h3 id="security-features-configuration">Security Features Configuration</h3>
<ul>
<li><strong>Multi-Factor Authentication</strong>: See <a href="../../configuration/security-policies/">Security Policies</a> for MFA setup</li>
<li><strong>Account Lockout Protection</strong>: Configure in <a href="../../configuration/security-policies/">Security Policies</a></li>
<li><strong>Enhanced Password Policies</strong>: Detailed configuration in <a href="../../configuration/password-policies/">Password Policies</a></li>
<li><strong>Password Reset System</strong>: Setup instructions in <a href="../../configuration/security-policies/">Security Policies</a></li>
</ul>
<h3 id="user-management-features_1">User Management Features</h3>
<ul>
<li><strong>User Agreement System</strong>: Complete setup guide in <a href="../../configuration/user-agreements/">User Agreements</a></li>
<li><strong>User Preferences System</strong>: Individual user customization options (automatically available once upgraded)</li>
</ul>
<h3 id="communication-features">Communication Features</h3>
<ul>
<li><strong>Enhanced Email System</strong>: New Twig-based templates covered in <a href="../../configuration/mail/">Mail Configuration</a></li>
<li><strong>Email Template Previews</strong>: Enable administrator preview functionality in <a href="../../configuration/mail/">Mail Configuration</a></li>
</ul>
<h3 id="external-services-integration">External Services Integration</h3>
<ul>
<li><strong>WHOIS Lookup</strong>: Configuration details in <a href="../../configuration/whois/">WHOIS Configuration</a></li>
<li><strong>RDAP Lookup</strong>: Setup instructions in <a href="../../configuration/rdap/">RDAP Configuration</a></li>
</ul>
<h3 id="api-and-development-features">API and Development Features</h3>
<ul>
<li><strong>API Key Management</strong>: Setup covered in <a href="../../configuration/api/">API Configuration</a></li>
<li><strong>Enhanced Logging</strong>: Advanced logging options in <a href="../../configuration/logging/">Logging Configuration</a></li>
</ul>
<p>For detailed information about all new settings and options, refer to <code>config/settings.defaults.php</code> which contains comprehensive documentation in comments.</p>
              

            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../" class="btn btn-neutral float-left" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../v3.9.3/" class="btn btn-neutral float-right" title="v3.9.3">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/poweradmin/poweradmin-docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../v3.9.3/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
